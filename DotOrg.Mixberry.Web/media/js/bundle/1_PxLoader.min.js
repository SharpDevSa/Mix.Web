(function(n){function i(n){var h,e,f,c,l;n=n||{};this.settings=n;n.statusInterval==null&&(n.statusInterval=5e3);n.loggingDelay==null&&(n.loggingDelay=2e4);n.noProgressTimeout==null&&(n.noProgressTimeout=Infinity);var r=[],u=[],o,s=Date.now(),i={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},a=function(n){return n==null?[]:Array.isArray(n)?n:[n]};this.add=function(n){n.tags=new t(n.tags);n.priority==null&&(n.priority=Infinity);r.push({resource:n,status:i.QUEUED})};this.addProgressListener=function(n,i){u.push({callback:n,tags:new t(i)})};this.addCompletionListener=function(n,i){u.push({tags:new t(i),callback:function(t){t.completedCount===t.totalCount&&n(t)}})};h=function(n){n=a(n);var t=function(t){for(var r,f=t.resource,i=Infinity,u=0;u<f.tags.length;u++)for(r=0;r<Math.min(n.length,i);r++){if(f.tags.all[u]===n[r]&&r<i&&(i=r,i===0))break;if(i===0)break}return i};return function(n,i){var r=t(n),u=t(i);return r<u?-1:r>u?1:n.priority<i.priority?-1:n.priority>i.priority?1:0}};this.start=function(n){var f,t,s,u;for(o=Date.now(),f=h(n),r.sort(f),t=0,s=r.length;t<s;t++)u=r[t],u.status=i.WAITING,u.resource.start(this);setTimeout(e,100)};e=function(){for(var t,u=!1,o=Date.now()-s,h=o>=n.noProgressTimeout,c=o>=n.loggingDelay,f=0,a=r.length;f<a;f++)(t=r[f],t.status===i.WAITING)&&(t.resource.checkStatus&&t.resource.checkStatus(),t.status===i.WAITING&&(h?t.resource.onTimeout():u=!0));c&&u&&l();u&&setTimeout(e,n.statusInterval)};this.isBusy=function(){for(var n=0,t=r.length;n<t;n++)if(r[n].status===i.QUEUED||r[n].status===i.WAITING)return!0;return!1};f=function(n,t){for(var e=null,a,h,l,f=0,o=r.length;f<o;f++)if(r[f].resource===n){e=r[f];break}if(e!=null&&e.status===i.WAITING)for(e.status=t,s=Date.now(),a=n.tags.length,f=0,o=u.length;f<o;f++)h=u[f],l=h.tags.length===0?!0:n.tags.intersects(h.tags),l&&c(e,h)};this.onLoad=function(n){f(n,i.LOADED)};this.onError=function(n){f(n,i.ERROR)};this.onTimeout=function(n){f(n,i.TIMEOUT)};c=function(n,t){for(var o=0,s=0,u,e,f=0,h=r.length;f<h;f++)u=r[f],e=!1,e=t.tags.length===0?!0:u.resource.tags.intersects(t.tags),e&&(s++,(u.status===i.LOADED||u.status===i.ERROR||u.status===i.TIMEOUT)&&o++);t.callback({resource:n.resource,loaded:n.status===i.LOADED,error:n.status===i.ERROR,timeout:n.status===i.TIMEOUT,completedCount:o,totalCount:s})};l=this.log=function(n){var e,f,s,u,t;if(window.console)for(e=Math.round((Date.now()-o)/1e3),window.console.log("PxLoader elapsed: "+e+" sec"),f=0,s=r.length;f<s;f++)if(u=r[f],n||u.status===i.WAITING){t="PxLoader: #"+f+" "+u.resource.getName();switch(u.status){case i.QUEUED:t+=" (Not Started)";break;case i.WAITING:t+=" (Waiting)";break;case i.LOADED:t+=" (Loaded)";break;case i.ERROR:t+=" (Error)";break;case i.TIMEOUT:t+=" (Timeout)"}u.resource.tags.length>0&&(t+=" Tags: ["+u.resource.tags.all.join(",")+"]");window.console.log(t)}}}function t(n){var i,t;if(this.all=[],this.first=null,this.length=0,this.lookup={},n){if(Array.isArray(n))this.all=n.slice(0);else if(typeof n=="object")for(i in n)n.hasOwnProperty(i)&&this.all.push(i);else this.all.push(n);for(this.length=this.all.length,this.length>0&&(this.first=this.all[0]),t=0;t<this.length;t++)this.lookup[this.all[t]]=!0}}t.prototype.intersects=function(n){if(this.length===0||n.length===0)return!1;if(this.length===1&&n.length===1)return this.first===n.first;if(n.length<this.length)return n.intersects(this);for(var t in this.lookup)if(n.lookup[t])return!0;return!1};typeof define=="function"&&define.amd&&define("PxLoader",[],function(){return i});n.PxLoader=i})(this);Date.now||(Date.now=function(){return(new Date).getTime()});Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"});
/*
//# sourceMappingURL=PxLoader.min.js.map
*/